title2 = 创建内容共享的应用
p2-1 = 本次课程教你怎样创建可以在应用和设备之间共享数据的app。
title2-1 = 共享简单数据
p2-1-1 = Android应用的其中一个最让人称赞的地方是他们可以和其他的应用交流和集成。为什么要重写那些已经在别的应用中存在的并且不是你的应用的主要功能的功能模块？
p2-1-2 = 本此课程会介绍一些在不同应用间发送和接收数据的方式，需要使用<code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> API 和 <code><a href="http://developer.android.com//reference/android/view/ActionProvider.html">ActionProvider</a></code> 对象。
sub_title2-1-1 = 课程
dt2-1-1-1 = <b><a href="#c2-1-1">向其他应用发送简单数据</a></b>
dd2-1-1-1 = 学习怎样使用Intent来让你的应用能够像别的应用发送文本或者二进制数据。
dt2-1-1-2 = <b><a href="#c2-1-2">从别的应用中接收简单数据</a></b>
dd2-1-1-2 = 学习怎样让你的应用从Intent中读取文本和二进制数据。
dt2-1-1-3 = <b><a href="#c2-1-3">添加一个简单的共享操作</a></b>
dd2-1-1-3 = 学习怎样给你的action bar添加一个简单的共享操作。
title2-1-1 = 向别的应用传递简单数据
p2-1-1-1 = 当你构造了一个Intent的时候，你必须指定一个你希望这个intent“出触发”的行为, android中定义了一些action，包括<code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code>， 就像你大概猜到的那样，这个intent是从一个activity向另外的activity发送数据，甚至有可能是跨进程的。要想向别的activity发送数据，你需要做的仅仅是指定要发送的数据和它的类型，系统将会找到合适的activity接收这些数据，然后展示出来(如果有多个选择的话) 或者直接打开一个activity (如果只有一个选择的话)。 类似的, 你可以通过配置manifest文件来声明你的应用可以接收的数据类型。
p2-1-1-2 = 在应用之间使用Intent传递和接收数据是共享数据的最常用的方式。Intent应用中可以快速的简单的实现数据共享。
nc2-1-1-1 = <strong>主义:</strong> 给 <code><a href="http://developer.android.com//reference/android/app/ActionBar.html">ActionBar</a></code>添加一个共享操作项的最好的方式是使用  <code><a href="http://developer.android.com//reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code>, API14 及其以上支持。 <code><a href="http://developer.android.com//reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code> 在<a href="c2-1-3">添加简单的共享操作</a>中有讨论。
sub_title2-1-1-1 = 发送文本内容
#share-text-screenshot.png
p2-1-1-1-1 = 最直接的并且最常用的使用 <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code>的方式是从一个activity向其他的activity发送文本内容。例如，内置的Browser应用可以和其他的应用以文本的形式共享当前展示的页面的URL。这在朋友之间通过邮件或者其他社交网络共享文章或者网站时是非常有用的。下面的代码实现了这种类型的共享：
#pre2-1-1-1-1
p2-1-1-1-2 = 如果已经安装了带有 <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code> 过滤器并且 MIME 类型是 text/plain的应用, Android系统就会调用它; 如果有多个应用符合条件, 系统将会展示一个弹出框（一个选择器）让你选择想要使用的app。
p2-1-1-1-3 = 然而, 如果你调用 <code><a href="http://developer.android.com//reference/android/content/Intent.html#createChooser(android.content.Intent, java.lang.CharSequence)">Intent.createChooser()</a></code>, 然后传给他你的 <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> 对象, 他将会返回你的intent，并且将会一直显示这个选择器。这样做有以下好处：
#ul
li2-1-1-1-1 = 即使用户已经为这个intent选择了默认的行为，这个选择器还是会展示。
li2-1-1-1-2 = 如果没有符合的应用, Android会显示一条系统消息。
li2-1-1-1-3 = 你可以为这个选择器指定一个标题。
p2-1-1-1-4 = 下面是更改后的代码:
#pre2-1-1-1-2
p2-1-1-1-5 = 最终的dialog会像图1中展示的那样。
p2-1-1-1-6 = 此外, 你可以为intent指定标准的额外的数据： <code><a href="http://developer.android.com//reference/android/content/Intent.html#EXTRA_EMAIL">EXTRA_EMAIL</a></code>, <code><a href="http://developer.android.com//reference/android/content/Intent.html#EXTRA_CC">EXTRA_CC</a></code>, <code><a href="http://developer.android.com//reference/android/content/Intent.html#EXTRA_BCC">EXTRA_BCC</a></code>, <code><a href="http://developer.android.com//reference/android/content/Intent.html#EXTRA_SUBJECT">EXTRA_SUBJECT</a></code>。如果接受到的应用不打算使用这些数据，只会简单的忽略掉。
nc2-1-1-1-1 = <strong>注意:</strong> 一些邮件应用, 例如Gmail, 会期望把一个 <code><a href="http://developer.android.com//reference/java/lang/String.html">String[]</a></code>作为extra,像<code><a href="http://developer.android.com//reference/android/content/Intent.html#EXTRA_EMAIL">EXTRA_EMAIL</a></code> 和 <code><a href="http://developer.android.com//reference/android/content/Intent.html#EXTRA_CC">EXTRA_CC</a></code>, 使用 <code><a href="http://developer.android.com//reference/android/content/Intent.html#putExtra(java.lang.String, java.lang.String[])">putExtra(String, String[])</a></code>把它们添加到你的intent中。
sub_title2-1-1-2 = 发送二进制数据
p2-1-1-2-1 = 二进制数据的共享是通过 <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code> action，并且要设置对应的MIME类型，然后添加到名为<code><a href="http://developer.android.com//reference/android/content/Intent.html#EXTRA_STREAM">EXTRA_STREAM</a></code>的extra数据中。通常被用于共享图片，还可以用于其他任何的二进制数据共享：
#pre2-1-1-2-1
p2-1-1-2-2 = 注意下面的内容:
#ul
li2-1-1-2-1 = 你可以把MIME类型设置为<code>"*/*"</code>, 但是他只会匹配那些能够处理一般的数据流的activity。
li2-1-1-2-2 = 接收数据的应用需要声明权限来使用 <code><a href="http://developer.android.com//reference/android/net/Uri.html">Uri</a></code> 指定的数据。推荐的实现方式是：
#ulbegin
li2-1-1-2-3 = 在自己的 <code><a href="http://developer.android.com//reference/android/content/ContentProvider.html">ContentProvider</a></code>中存储数据, 要确保其他的应用有这个权限可以访问你的provider。访问provider的首选机制是使用<a href="http://developer.android.com//guide/topics/security/permissions.html#uri">per-URI permissions</a>，它是暂时的并且只给那些接收数据的应用分配使用权限。 创建一个 <code><a href="http://developer.android.com//reference/android/content/ContentProvider.html">ContentProvider</a></code> 的很好的方式是使用<code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> 帮助类。
li2-1-1-2-4 = 使用系统的<code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code>。 <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code> 是主要针对音频，视频和图片类型。然而，从Android3.0开始 (API 11) 也可以存储非媒体类型(参考 <code><a href="http://developer.android.com//reference/android/provider/MediaStore.Files.html">MediaStore.Files</a></code> )。 Files can be inserted into the <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code> 使用 <code><a href="http://developer.android.com//reference/android/media/MediaScannerConnection.html#scanFile(android.content.Context, java.lang.String[], java.lang.String[], android.media.MediaScannerConnection.OnScanCompletedListener)">scanFile()</a></code> 跟在<code>content://</code> style <code><a href="http://developer.android.com//reference/android/net/Uri.html">Uri</a></code> suitable for sharing is passed to the provided <code><a href="http://developer.android.com//reference/android/media/MediaScannerConnection.OnScanCompletedListener.html#onScanCompleted(java.lang.String, android.net.Uri)">onScanCompleted()</a></code> callback. Note that once added to the system <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code> the content is accessible to any app on the device.
#end
sub_title2-1-1-3 = 发送多个内容块
p2-1-1-3-1 = 要想同时共享多个内容模块, 需要使用<code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_SEND_MULTIPLE">ACTION_SEND_MULTIPLE</a></code> action 和指向内容的URI。 MIME类型整合了你需要共享的内容的类型。例如，如果你需要共享三个JPEG图片，那么MIME类型应该是<code>"image/jpeg"</code>。对于混合的图片类型，也应该是使用 <code>"image/*"</code> 来匹配那些可以处理任何图片类型的activity。如果你需要共享的类型有很多，你只需要使用 <code>"*/*"</code>。 如上所述, 怎样解析和处理你的数据是由接收数据的应用决定的。这里有一个例子:
#pre2-1-1-3-1
p2-1-1-3-2 = 和前面一样, 要确保指向数据的<code><a href="http://developer.android.com//reference/android/net/Uri.html">URIs</a></code>对接受者应用来讲是可用的。 
title2-1-2 = 从别的应用接收简单数据
p2-1-2-1 = 就像你的应用可以向别的应用发送数据一样，那么他也可以从别的应用接收数据。考虑一下你的应用时怎样和用户交互的，你希望从别的应用中获取什么类型的数据。例如， 一个社交网络应用会比较想要从别的应用接收像WEB URL这样的文本内容。<a href="http://developer.android.com/https://play.google.com/store/apps/details?id=com.google.android.apps.plus">Google+ Android 应用</a> 可以接收文本和单个或多个图片。使用这款app，用户可以很简单的使用从Android相册应用中的图片开启一个新的Google+ 发送操作。
sub_title2-1-2-1 = 更新你的Manifest
p2-1-2-1-1 = Intent filter告诉系统这个应用组件可以接收什么样的intent。就像在<a href="#c2-1-1">向别的应用发送简单数据</a> 课程中那样，创建了一个action为<code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code>的Intent，创建intent filter的目的是要接收那些使用了这个action的intent。 使用 <code><a href="http://developer.android.com//guide/components/intents-filters.html#ifs">&lt;intent-filter&gt;</a></code> 元素在manifest中定义intent filter。 例如， 如果你的应用可以处理文本，单张任何类型的图片，或者任何类型的多张图片，那么你的manifest应该是这样的：
#pre2-1-2-1-1
nc2-1-2-1-1 = <strong>注意:</strong> 更多冠以intent filter和intent 解决方案的信息，请参考<a href="http://developer.android.com//guide/components/intents-filters.html#ifs">Intents 和 Intent Filters</a>
p2-1-2-1-2 = 当其他的应用试图通过构造intent对象，然后把它传递给<code><a href="http://developer.android.com//reference/android/content/Context.html#startActivity(android.content.Intent)">startActivity()</a></code>来共享这些内容，你的应用将会出现在intent选择器中。如果用户选择了你的应用，对应的activity(在上面的例子中是<code>.ui.MyActivity</code>)将会被打开。那么接下来就取决于你怎样在代码和UI中处理这些内容。
sub_title2-1-2-2 = 处理增值内容
p2-1-2-2-1 = 想要处理通过 <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code>传递的数据, 从 calling <code><a href="http://developer.android.com//reference/android/content/Intent.html#getIntent(java.lang.String)">getIntent()</a></code> 开始，获得一个 <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> 对象。一旦你有了这个对象，你就可以检测他的内容，然后再决定怎样处理。请记住，如果一个activity可以从系统的其他地方打开，那么你需要考虑在什么时候检测这个intent。 
#pre2-1-2-2-1
cc2-1-2-2-1 = <strong>警告:</strong> 请花点精力检查增值数据，你永远不知道其他的应用会发送给你什么数据。例如，设置了错误的MIME类型，或者发送的图片太大。此外，要记住在非UI线程中处理二进制数据。
p2-1-2-2-2 = 更新UI可以像填充一个<code><a href="http://developer.android.com//reference/android/widget/EditText.html">EditText</a></code>这样简单, 也可以像过滤感兴趣的图片那样复杂。怎样处理完全取决于你的应用。
title2-1-3 = 添加一个简单的共享操作
p2-1-3-1 = 学习了 <code><a href="http://developer.android.com//reference/android/view/ActionProvider.html">ActionProvider</a></code> 之后，在Android 4.0以上(API 14)在你的<code><a href="http://developer.android.com//reference/android/app/ActionBar.html">ActionBar</a></code>上添加一个高效的用户友好的共享操作就变的非常简单。 一个 <code><a href="http://developer.android.com//reference/android/view/ActionProvider.html">ActionProvider</a></code>, 一旦绑定了action bar中的menu项， 就需要处理这个item的外观和行为。就 <code><a href="http://developer.android.com//reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code>来说, 你只需要提供一个共享的Intent，然后剩下的交给它。
nc2-1-3-1 = <strong>注意:&nbsp;</strong> <code><a href="http://developer.android.com//reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code> 在API 14及其以上可用。
#actionbar-shareaction.png
sub_title2-1-3-1 = 修改MENU声明
p2-1-3-1-1 = 开始使用<code><a href="http://developer.android.com//reference/android/widget/ShareActionProvider.html">ShareActionProviders</a></code>, 为在a href="http://developer.android.com//guide/topics/resources/menu-resource.html">menu resource</a> 文件中对应的<code>&lt;item&gt;</code>添加 <code>android:actionProviderClass</code> 属性:
#pre2-1-3-1-1
p2-1-3-1-2 = 这就声明了由谁来负责item的外观以及 <code><a href="http://developer.android.com//reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code>的功能。然热，你需要告诉provider你想要共享什么数据。 
sub_title2-1-3-2 = 设置共享Intent
p2-1-3-2-1 =要想让 <code><a href="http://developer.android.com//reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code> 运行，你必须制定一个共享 intent。这个共享intent应该和<a href="#c2-1-1">向别的应用发送简单数据</a> 课程中一样，使用 <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_SEND">ACTION_SEND</a></code>action，然后使用extras设置额外的数据，像<code><a href="http://developer.android.com//reference/android/content/Intent.html#EXTRA_TEXT">EXTRA_TEXT</a></code> 和 <code><a href="http://developer.android.com//reference/android/content/Intent.html#EXTRA_STREAM">EXTRA_STREAM</a></code>。 要想指派一个共享 intent, 在初始化<code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code>或者<code><a href="http://developer.android.com//reference/android/app/Fragment.html">Fragment</a></code>中的menu资源的时候，首先要找到对应的<code><a href="http://developer.android.com//reference/android/view/MenuItem.html">MenuItem</a></code>，然后，在调用<code><a href="http://developer.android.com//reference/android/view/MenuItem.html#getActionProvider()">MenuItem.getActionProvider()</a></code> 来获取<code><a href="http://developer.android.com//reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code>的实例。 使用 <code><a href="http://developer.android.com//reference/android/widget/ShareActionProvider.html#setShareIntent(android.content.Intent)">setShareIntent()</a></code> 来更新和action item想关联的共享intent。示例如下：
#pre2-1-3-2-1
p2-1-3-2-2 = 你只需要在创建menu的时候设置一下共享intent，你有可能设置了之后想要根据UI的变化来修改它。例如，当你在使用Gallery应用全屏查看图片的时候，在你滑动图片的时候共享intent会随之改变。
p2-1-3-2-3 = 关于<code><a href="http://developer.android.com//reference/android/widget/ShareActionProvider.html">ShareActionProvider</a></code> 对象更深入的讨论,请参考 <a href="http://developer.android.com//guide/topics/ui/actionbar.html#ActionProvider">Action Bar</a> 指南。
title2-2 = 共享文件
p2-2-1 = 应用通常需要为其他的应用提供一个或多个文件。例如，一个图片相册有可能要为图片编辑器提供图片，或者一个文件管理应用可能需要允许用户在不同的外部存储之间复制和粘贴文件。发送者应用共享文件的其中一个方式是响应接收者应用的请求。
p2-2-2 = 在所有的情况下, 从你的应用中给别的应用提供文件的唯一一个安全的方式是发送文件Content URI，然后给这个URI添加临时访问权限。带有临时URI访问权限的Content URI是安全的，因为他们只对那些需要接受这个URI的应用可用，并且他们会自动失效。 Android <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> 组件提供了 <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html#getUriForFile(android.content.Context, java.lang.String, java.io.File)">getUriForFile()</a></code>方法，这个方法可用于生成文件的 content URI。
p2-2-3 = 如果你想要在应用间共享比较小的文本或者数字，你应该发送一个包含这些数据的<code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> 。想要学习怎样使用<code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code>发送简单数据，请参考 培训课程 <a href="http://developer.android.com//training/sharing/index.html">共享简单数据</a>。
p2-2-4 = 本次课程解释了怎样使用Android <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code>生成的content URI以及分配给接受者应用的 Content URI的临时权限，来安全的让你的应用和别的应用共享文件。
sub_title2-2-1 = 课程
dt2-2-1-1 = <b><a href="http://developer.android.com/setup-sharing.html">设置文件共享</a></b>
dd2-2-1-1 = 学习怎样设置你的应用来实现文件共享。
dt2-2-1-2 = <b><a href="http://developer.android.com/share-file.html">共享一个文件</a></b>
dd2-2-1-2 = 学习怎样通过生成一个文件的content URI来给别的应用提供文件，怎样为URI分配临时访问权限，以及怎样给应用传递这个URI。
dt2-2-1-3 = <b><a href="http://developer.android.com/request-file.html">请求一个共享文件</a></b>
dd2-2-1-3 = 学习怎样请求一个别的应用共享的文件, 获取该文件的 content URI，然后使用这个content URI 打开文件。
dt2-2-1-4 = <b><a href="http://developer.android.com/retrieve-info.html">获取文件信息</a></b>
dd2-2-1-4 = 学习怎样在应用中通过<code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code>生成的content URI，来获取文件信息，包括MIME类型和文件大小。
title2-2-1 = 配置文件共享
p2-2-1-1 = 想要安全的给别的应用提供文，你需要配置你的应用来给这个文件提供一个安全的处理方式，以content URI的形式。Android <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> 组件用于根据你在XML中的说明来生成文件的content URI。本次课程教你怎样为你的应用添加默认的 <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> 实现, 以及怎样制定哪些你想要提供给别的应用的文件。
nc2-2-1-1 = <strong>注意:</strong>  <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> 类是 <a href="http://developer.android.com//tools/support-library/features.html#v4">v4 Support Library</a>的一部分。更多的关于这特 library的信息，请参考<a href="http://developer.android.com//tools/support-library/setup.html">Support Library Setup</a>。
sub_title2-2-1-1 = 指定FileProvider
p2-2-1-1-1 = Defining a <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> for your app requires an entry in your manifest. This entry specifies the authority to use in generating content URIs, as well as the name of an XML file that specifies the directories your app can share.
p2-2-1-1-2 = The following snippet shows you how to add to your manifest the <code><a href="http://developer.android.com//guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></code> element that specifies the <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> class, the authority, and the XML file name:
#pre2-2-1-1-1
p2-2-1-1-3 = In this example, the <code><a href="http://developer.android.com//guide/topics/manifest/provider-element.html#auth">android:authorities</a></code> attribute specifies the URI authority that you want to use for content URIs generated by the <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code>. In the example, the authority is <code>com.example.myapp.fileprovider</code>. For your own app, specify an authority consisting of the app's <code><a href="http://developer.android.com//guide/topics/manifest/manifest-element.html#package">android:package</a></code> value with the string "fileprovider" appended to it. To learn more about the authority value, see the topic <a href="http://developer.android.com//guide/topics/providers/content-provider-basics.html#ContentURIs">Content URIs</a> and the documentation for the <code><a href="http://developer.android.com//guide/topics/manifest/provider-element.html#auth">android:authorities</a></code> attribute.
p2-2-1-1-4 = The <code><a href="http://developer.android.com//guide/topics/manifest/meta-data-element.html">&lt;meta-data&gt;</a></code> child element of the <code><a href="http://developer.android.com//guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></code> points to an XML file that specifies the directories you want to share. The <code>android:resource</code> attribute is the path and name of the file, without the <code>.xml</code> extension.The contents of this file are described in the next section.
sub_title2-2-1-2 = Specify Sharable Directories
p2-2-1-2-1 = Once you have added the <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> to your app manifest, you need to specify the directories that contain the files you want to share. To specify the directories, start by creating the file <code>filepaths.xml</code> in the <code>res/xml/</code> subdirectory of your project. In this file, specify the directories by adding an XML element for each directory. The following snippet shows you an example of the contents of <code>res/xml/filepaths.xml</code>. The snippet also demonstrates how to share a subdirectory of the <code>files/</code> directory in your internal storage area:
#pre2-2-1-2-1
p2-2-1-2-2 = In this example, the <code>&lt;files-path&gt;</code> tag shares directories within the <code>files/</code> directory of your app's internal storage. The <code>path</code> attribute shares the <code>images/</code> subdirectory of <code>files/</code>. The <code>name</code> attribute tells the <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> to add the path segment <code>myimages</code> to content URIs for files in the <code>files/images/</code> subdirectory.
p2-2-1-2-3 = The <code>&lt;paths&gt;</code> element can have multiple children, each specifying a different directory to share. In addition to the <code>&lt;files-path&gt;</code> element, you can use the <code>&lt;external-path&gt;</code> element to share directories in external storage, and the <code>&lt;cache-path&gt;</code> element to share directories in your internal cache directory. To learn more about the child elements that specify shared directories, see the <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> reference documentation.
nc2-2-1-2-1 = <strong>Note:</strong> The XML file is the only way you can specify the directories you want to share; you can't programmatically add a directory.
p2-2-1-2-4 = You now have a complete specification of a <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> that generates content URIs for files in the <code>files/</code> directory of your app's internal storage or for files in subdirectories of <code>files/</code>. When your app generates a content URI for a file, it contains the authority specified in the <code><a href="http://developer.android.com//guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></code> element (<code>com.example.myapp.fileprovider</code>), the path <code>myimages/</code>, and the name of the file.
p2-2-1-2-5 = For example, if you define a <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> according to the snippets in this lesson, and you request a content URI for the file <code>default_image.jpg</code>, <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> returns the following URI:
#pre2-2-1-2-2
title2-2-2 = Sharing a File
p2-2-2-1 = Once you have set up your app to share files using content URIs, you can respond to other apps' requests for those files. One way to respond to these requests is to provide a file selection interface from the server app that other applications can invoke. This approach allows a client application to let users select a file from the server app and then receive the selected file's content URI.
p2-2-2-2 = This lesson shows you how to create a file selection <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code> in your app that responds to requests for files.
sub_title2-2-2-1 = Receive File Requests
p2-2-2-1-1 = To receive requests for files from client apps and respond with a content URI, your app should provide a file selection <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code>. Client apps start this <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code> by calling <code><a href="http://developer.android.com//reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code> with an <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> containing the action <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_PICK">ACTION_PICK</a></code>. When the client app calls <code><a href="http://developer.android.com//reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult()</a></code>, your app can return a result to the client app, in the form of a content URI for the file the user selected.
p2-2-2-1-2 = To learn how to implement a request for a file in a client app, see the lesson <a href="http://developer.android.com/request-file.html">Requesting a Shared File</a>.
sub_title2-2-2-2 = Create a File Selection Activity
p2-2-2-2-1 = To set up the file selection <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code>, start by specifying the <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code> in your manifest, along with an intent filter that matches the action <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_PICK">ACTION_PICK</a></code> and the categories <code><a href="http://developer.android.com//reference/android/content/Intent.html#CATEGORY_DEFAULT">CATEGORY_DEFAULT</a></code> and <code><a href="http://developer.android.com//reference/android/content/Intent.html#CATEGORY_OPENABLE">CATEGORY_OPENABLE</a></code>. Also add MIME type filters for the files your app serves to other apps. The following snippet shows you how to specify the new <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code> and intent filter:
#pre2-2-2-2-1
lead2-2-2-2-1 = Define the file selection Activity in code
p2-2-2-2-2 = Next, define an <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code> subclass that displays the files available from your app's <code>files/images/</code> directory in internal storage and allows the user to pick the desired file. The following snippet demonstrates how to define this <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code> and respond to the user's selection:
#pre2-2-2-2-2
sub_title2-2-2-3 = Respond to a File Selection
p2-2-2-3-1 = Once a user selects a shared file, your application must determine what file was selected and then generate a content URI for the file. Since the <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code> displays the list of available files in a <code><a href="http://developer.android.com//reference/android/widget/ListView.html">ListView</a></code>, when the user clicks a file name the system calls the method <code><a href="http://developer.android.com//reference/android/widget/AdapterView.OnItemClickListener.html#onItemClick(android.widget.AdapterView<?>, android.view.View, int, long)">onItemClick()</a></code>, in which you can get the selected file.
p2-2-2-3-2 = In <code><a href="http://developer.android.com//reference/android/widget/AdapterView.OnItemClickListener.html#onItemClick(android.widget.AdapterView<?>, android.view.View, int, long)">onItemClick()</a></code>, get a <code><a href="http://developer.android.com//reference/java/io/File.html">File</a></code> object for the file name of the selected file and pass it as an argument to <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html#getUriForFile(android.content.Context, java.lang.String, java.io.File)">getUriForFile()</a></code>, along with the authority that you specified in the <code><a href="http://developer.android.com//guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></code> element for the <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code>. The resulting content URI contains the authority, a path segment corresponding to the file's directory (as specified in the XML meta-data), and the name of the file including its extension. How <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> maps directories to path segments based on XML meta-data is described in the section <a href="http://developer.android.com/setup-sharing.html#DefineMetaData">Specify Sharable Directories</a>.
p2-2-2-3-3 = The following snippet shows you how to detect the selected file and get a content URI for it:
#pre2-2-2-3-1
p2-2-2-3-4 = Remember that you can only generate content URIs for files that reside in a directory you've specified in the meta-data file that contains the <code>&lt;paths&gt;</code> element, as described in the section <a href="http://developer.android.com/setup-sharing.html#DefineMetaData">Specify Sharable Directories</a>. If you call <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html#getUriForFile(android.content.Context, java.lang.String, java.io.File)">getUriForFile()</a></code> for a <code><a href="http://developer.android.com//reference/java/io/File.html">File</a></code> in a path that you haven't specified, you receive an <code><a href="http://developer.android.com//reference/java/lang/IllegalArgumentException.html">IllegalArgumentException</a></code>.
sub_title2-2-2-4 = Grant Permissions for the File
p2-2-2-4-1 = Now that you have a content URI for the file you want to share with another app, you need to allow the client app to access the file. To allow access, grant permissions to the client app by adding the content URI to an <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> and then setting permission flags on the <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code>. The permissions you grant are temporary and expire automatically when the receiving app's task stack is finished.
p2-2-2-4-2 = The following code snippet shows you how to set read permission for the file:
#pre2-2-2-4-1
cc2-2-2-4-1 = <strong>Caution:</strong> Calling <code><a href="http://developer.android.com//reference/android/content/Intent.html#setFlags(int)">setFlags()</a></code> is the only way to securely grant access to your files using temporary access permissions. Avoid calling <code><a href="http://developer.android.com//reference/android/content/Context.html#grantUriPermission(java.lang.String, android.net.Uri, int)">Context.grantUriPermission()</a></code> method for a file's content URI, since this method grants access that you can only revoke by calling <code><a href="http://developer.android.com//reference/android/content/Context.html#revokeUriPermission(android.net.Uri, int)">Context.revokeUriPermission()</a></code>.
sub_title2-2-2-5 = Share the File with the Requesting App
p2-2-2-5-1 = To share the file with the app that requested it, pass the <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> containing the content URI and permissions to <code><a href="http://developer.android.com//reference/android/app/Activity.html#setResult(int)">setResult()</a></code>. When the <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code> you have just defined is finished, the system sends the <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> containing the content URI to the client app. The following code snippet shows you how to do this:
#pre2-2-2-5-1
p2-2-2-5-2 = Provide users with an way to return immediately to the client app once they have chosen a file. One way to do this is to provide a checkmark or <b>Done</b> button. Associate a method with the button using the button's <code><a href="http://developer.android.com//reference/android/view/View.html#attr_android:onClick">android:onClick</a></code> attribute. In the method, call <code><a href="http://developer.android.com//reference/android/app/Activity.html#finish()">finish()</a></code>. For example:
#pre2-2-2-5-2
title2-2-3 = Requesting a Shared File
p2-2-3-1 = When an app wants to access a file shared by another app, the requesting app (the client) usually sends a request to the app sharing the files (the server). In most cases, the request starts an <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code> in the server app that displays the files it can share. The user picks a file, after which the server app returns the file's content URI to the client app.
p2-2-3-2 = This lesson shows you how a client app requests a file from a server app, receives the file's content URI from the server app, and opens the file using the content URI.
sub_title2-2-3-1 = Send a Request for the File
p2-2-3-1-1 = To request a file from the server app, the client app calls <code><a href="http://developer.android.com//reference/android/app/Activity.html#startActivityForResult(android.content.Intent, int)">startActivityForResult</a></code> with an <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> containing the action such as <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_PICK">ACTION_PICK</a></code> and a MIME type that the client app can handle.
p2-2-3-1-2 = For example, the following code snippet demonstrates how to send an <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> to a server app in order to start the <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code> described in <a href="http://developer.android.com/share-file.html#SendURI">Sharing a File</a>:
#pre2-2-3-1-1
sub_title2-2-3-2 = Access the Requested File
p2-2-3-2-1 = The server app sends the file's content URI back to the client app in an <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code>. This <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> is passed to the client app in its override of <code><a href="http://developer.android.com//reference/android/app/Activity.html#onActivityResult(int, int, android.content.Intent)">onActivityResult()</a></code>. Once the client app has the file's content URI, it can access the file by getting its <code><a href="http://developer.android.com//reference/java/io/FileDescriptor.html">FileDescriptor</a></code>.
p2-2-3-2-2 = File security is preserved in this process because the content URI is the only piece of data that the client app receives. Since this URI doesn't contain a directory path, the client app can't discover and open any other files in the server app. Only the client app gets access to the file, and only for the permissions granted by the server app. The permissions are temporary, so once the client app's task stack is finished, the file is no longer accessible outside the server app.
p2-2-3-2-3 = The next snippet demonstrates how the client app handles the <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> sent from the server app, and how the client app gets the <code><a href="http://developer.android.com//reference/java/io/FileDescriptor.html">FileDescriptor</a></code> using the content URI:
#pre2-2-3-2-1
p2-2-3-2-4 = The method <code><a href="http://developer.android.com//reference/android/content/ContentResolver.html#openFileDescriptor(android.net.Uri, java.lang.String)">openFileDescriptor()</a></code> returns a <code><a href="http://developer.android.com//reference/android/os/ParcelFileDescriptor.html">ParcelFileDescriptor</a></code> for the file. From this object, the client app gets a <code><a href="http://developer.android.com//reference/java/io/FileDescriptor.html">FileDescriptor</a></code> object, which it can then use to read the file.
title2-2-4 = Retrieving File Information
p2-2-4-1 = Before a client app tries to work with a file for which it has a content URI, the app can request information about the file from the server app, including the file's data type and file size. The data type helps the client app to determine if it can handle the file, and the file size helps the client app set up buffering and caching for the file.
p2-2-4-2 = This lesson demonstrates how to query the server app's <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> to retrieve a file's MIME type and size.
sub_title2-2-4-1 = Retrieve a File's MIME Type
p2-2-4-1-1 = A file's data type indicates to the client app how it should handle the file's contents. To get the data type of a shared file given its content URI, the client app calls <code><a href="http://developer.android.com//reference/android/content/ContentResolver.html#getType(android.net.Uri)">ContentResolver.getType()</a></code>. This method returns the file's MIME type. By default, a <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> determines the file's MIME type from its filename extension.
p2-2-4-1-2 = The following code snippet demonstrates how a client app retrieves the MIME type of a file once the server app has returned the content URI to the client:
#pre2-2-4-1-1
sub_title2-2-4-2 = Retrieve a File's Name and Size
p2-2-4-2-1 = The <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html">FileProvider</a></code> class has a default implementation of the <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">query()</a></code> method that returns the name and size of the file associated with a content URI in a <code><a href="http://developer.android.com//reference/android/database/Cursor.html">Cursor</a></code>. The default implementation returns two columns:
dt2-2-4-2-1 = <code><a href="http://developer.android.com//reference/android/provider/OpenableColumns.html#DISPLAY_NAME">DISPLAY_NAME</a></code>
dd2-2-4-2-1 = The file's name, as a  <code><a href="http://developer.android.com//reference/java/lang/String.html">String</a></code>. This value is the same as the value returned by  <code><a href="http://developer.android.com//reference/java/io/File.html#getName()">File.getName()</a></code>.
dt2-2-4-2-2 = <code><a href="http://developer.android.com//reference/android/provider/OpenableColumns.html#SIZE">SIZE</a></code>
dd2-2-4-2-2 = The size of the file in bytes, as a  <code>long</code> This value is the same as the value returned by  <code><a href="http://developer.android.com//reference/java/io/File.html#length()">File.length()</a></code>
p2-2-4-2-2 = The client app can get both the <code><a href="http://developer.android.com//reference/android/provider/OpenableColumns.html#DISPLAY_NAME">DISPLAY_NAME</a></code> and <code><a href="http://developer.android.com//reference/android/provider/OpenableColumns.html#SIZE">SIZE</a></code> for a file by setting all of the arguments of <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html#query(android.net.Uri, java.lang.String[], java.lang.String, java.lang.String[], java.lang.String)">query()</a></code> to <code>null</code> except for the content URI. For example, this code snippet retrieves a file's <code><a href="http://developer.android.com//reference/android/provider/OpenableColumns.html#DISPLAY_NAME">DISPLAY_NAME</a></code> and <code><a href="http://developer.android.com//reference/android/provider/OpenableColumns.html#SIZE">SIZE</a></code> and displays each one in separate <code><a href="http://developer.android.com//reference/android/widget/TextView.html">TextView</a></code>:
#pre2-2-4-2-1
title2-3 = Sharing Files with NFC
p2-3-1 = Android allows you to transfer large files between devices using the Android Beam file transfer feature. This feature has a simple API and allows users to start the transfer process by simply touching devices. In response, Android Beam file transfer automatically copies files from one device to the other and notifies the user when it's finished.
p2-3-2 = While the Android Beam file transfer API handles large amounts of data, the Android Beam NDEF transfer API introduced in Android 4.0 (API level 14) handles small amounts of data such as URIs or other small messages. In addition, Android Beam is only one of the features available in the Android NFC framework, which allows you to read NDEF messages from NFC tags. To learn more about Android Beam, see the topic <a href="http://developer.android.com//guide/topics/connectivity/nfc/nfc.html#p2p">Beaming NDEF Messages to Other Devices</a>. To learn more about the NFC framework, see the <a href="http://developer.android.com//guide/topics/connectivity/nfc/index.html">Near Field Communication</a> API guide.
sub_title2-3-1 = Lessons
dt2-3-1-1 = <b><a href="#c2-3-1">Sending Files to Another Device</a></b>
dd2-3-1-1 = Learn how to set up your app to send files to another device.
dt2-3-1-2 = <b><a href="c2-3-2">Receiving Files from Another Device</a></b>
dd2-3-1-2 = Learn how to set up your app to receive files sent by another device.
title2-3-1 = Sending Files to Another Device
p2-3-1-1 = This lesson shows you how to design your app to send large files to another device using Android Beam file transfer. To send files, you request permission to use NFC and external storage, test to ensure your device supports NFC, and provide URIs to Android Beam file transfer.
p2-3-1-2 = The Android Beam file transfer feature has the following requirements:
#ol
li2-3-1-1 = Android Beam file transfer for large files is only available in Android 4.1 (API level 16) and higher.
li2-3-1-2 = Files you want to transfer must reside in external storage. To learn more about using external storage, read <a href="http://developer.android.com//guide/topics/data/data-storage.html#filesExternal">Using the External Storage</a>.
li2-3-1-3 = Each file you want to transfer must be world-readable. You can set this permission by calling the method <code><a href="http://developer.android.com//reference/java/io/File.html#setReadable(boolean)">File.setReadable(true,false)</a></code>.
li2-3-1-4 = You must provide a file URI for the files you want to transfer. Android Beam file transfer is unable to handle content URIs generated by <code><a href="http://developer.android.com//reference/android/support/v4/content/FileProvider.html#getUriForFile(android.content.Context, java.lang.String, java.io.File)">FileProvider.getUriForFile</a></code>.
sub_title2-3-1-1 = Declare Features in the Manifest
p2-3-1-1-1 = First, edit your app manifest to declare the permissions and features your app needs.
lead2-3-1-1-1 = Request Permissions
p2-3-1-1-2 = To allow your app to use Android Beam file transfer to send files from external storage using NFC, you must request the following permissions in your app manifest:
dt2-3-1-1-1 = <code><a href="http://developer.android.com//reference/android/Manifest.permission.html#NFC">NFC</a></code>
dd2-3-1-1-1 = Allows your app to send data over NFC. To specify this permission, add the following element as a child of the  <code><a href="http://developer.android.com//guide/topics/manifest/manifest-element.html">&lt;manifest&gt;</a></code> element:  <pre>     &lt;uses-permission android:name="android.permission.NFC" /&gt; </pre>
dt2-3-1-1-2 = <code><a href="http://developer.android.com//reference/android/Manifest.permission.html#READ_EXTERNAL_STORAGE">READ_EXTERNAL_STORAGE</a></code>
dd2-3-1-1-2 = Allows your app to read from external storage. To specify this permission, add the following element as a child of the  <code><a href="http://developer.android.com//guide/topics/manifest/manifest-element.html">&lt;manifest&gt;</a></code> element:  <pre>     &lt;uses-permission             android:name="android.permission.READ_EXTERNAL_STORAGE" /&gt; </pre>  <p class="note"> <strong>Note:</strong> As of Android 4.2.2 (API level 17), this permission is not enforced. Future versions of the platform may require it for apps that want to read from external storage. To ensure forward compatibility, request the permission now, before it becomes required. </p>
lead2-3-1-1-2 = Specify the NFC feature
p2-3-1-1-3 = Specify that your app uses NFC, by adding a <code><a href="http://developer.android.com//guide/topics/manifest/uses-feature-element.html">&lt;uses-feature&gt;</a></code> element as a child of the <code><a href="http://developer.android.com//guide/topics/manifest/manifest-element.html">&lt;manifest&gt;</a></code> element. Set the <code>android:required</code> attribute to <code>true</code> to indicate that your app won't function unless NFC is present.
p2-3-1-1-4 = The following snippet shows you how to specify the <code><a href="http://developer.android.com//guide/topics/manifest/uses-feature-element.html">&lt;uses-feature&gt;</a></code> element:
#pre2-3-1-1-1
p2-3-1-1-5 = Note that if your app only uses NFC as an option, but still functions if NFC isn't present, you should set <code>android:required</code> to <code>false</code>, and test for NFC in code.
lead2-3-1-1-3 = Specify Android Beam file transfer
p2-3-1-1-6 = Since Android Beam file transfer is only available in Android 4.1 (API level 16) and later, if your app depends on Android Beam file transfer for a key part of its functionality you must specify the <code><a href="http://developer.android.com//guide/topics/manifest/uses-sdk-element.html">&lt;uses-sdk&gt;</a></code> element with the <code><a href="http://developer.android.com//guide/topics/manifest/uses-sdk-element.html#min">android:minSdkVersion</a>="16"</code> attribute. Otherwise, you can set <code><a href="http://developer.android.com//guide/topics/manifest/uses-sdk-element.html#min">android:minSdkVersion</a></code> to another value as necessary, and test for the platform version in code, as described in the following section.
sub_title2-3-1-2 = Test for Android Beam File Transfer Support
p2-3-1-2-1 = To specify in your app manifest that NFC is optional, you use the following element:
#pre2-3-1-2-1
p2-3-1-2-2 = If you set the attribute <code><a href="http://developer.android.com//guide/topics/manifest/uses-feature-element.html#required">android:required</a>="false"</code>, you must test for NFC support and Android Beam file transfer support in code.
p2-3-1-2-3 = To test for Android Beam file transfer support in code, start by testing that the device supports NFC by calling <code><a href="http://developer.android.com//reference/android/content/pm/PackageManager.html#hasSystemFeature(java.lang.String)">PackageManager.hasSystemFeature()</a></code> with the argument <code><a href="http://developer.android.com//reference/android/content/pm/PackageManager.html#FEATURE_NFC">FEATURE_NFC</a></code>. Next, check that the Android version supports Android Beam file transfer by testing the value of <code><a href="http://developer.android.com//reference/android/os/Build.VERSION.html#SDK_INT">SDK_INT</a></code>. If Android Beam file transfer is supported, get an instance of the NFC controller, which allows you to communicate with the NFC hardware. For example:
#pre2-3-1-2-2
sub_title2-3-1-3 = Create a Callback Method that Provides Files
p2-3-1-3-1 = Once you've verified that the device supports Android Beam file transfer, add a callback method that the system invokes when Android Beam file transfer detects that the user wants to send files to another NFC-enabled device. In this callback method, return an array of <code><a href="http://developer.android.com//reference/android/net/Uri.html">Uri</a></code> objects. Android Beam file transfer copies the files represented by these URIs to the receiving device.
p2-3-1-3-2 = To add the callback method, implement the <code><a href="http://developer.android.com//reference/android/nfc/NfcAdapter.CreateBeamUrisCallback.html">NfcAdapter.CreateBeamUrisCallback</a></code> interface and its method <code><a href="http://developer.android.com//reference/android/nfc/NfcAdapter.CreateBeamUrisCallback.html#createBeamUris(android.nfc.NfcEvent)">createBeamUris()</a></code>. The following snippet shows you how to do this:
#pre2-3-1-3-1
p2-3-1-3-3 = Once you've implemented the interface, provide the callback to Android Beam file transfer by calling <code><a href="http://developer.android.com//reference/android/nfc/NfcAdapter.html#setBeamPushUrisCallback(android.nfc.NfcAdapter.CreateBeamUrisCallback, android.app.Activity)">setBeamPushUrisCallback()</a></code>. The following snippet shows you how to do this:
#pre2-3-1-3-2
nc2-3-1-3-1 = <strong>Note:</strong> You can also provide the array of <code><a href="http://developer.android.com//reference/android/net/Uri.html">Uri</a></code> objects directly to the NFC framework through your app's <code><a href="http://developer.android.com//reference/android/nfc/NfcAdapter.html">NfcAdapter</a></code> instance. Choose this approach if you can define the URIs to transfer before the NFC touch event occurs. To learn more about this approach, see <code><a href="http://developer.android.com//reference/android/nfc/NfcAdapter.html#setBeamPushUris(android.net.Uri[], android.app.Activity)">NfcAdapter.setBeamPushUris()</a></code>.
sub_title2-3-1-4 = Specify the Files to Send
p2-3-1-4-1 = To transfer one or more files to another NFC-enabled device, get a file URI (a URI with a <code>file</code> scheme) for each file and then add the URI to an array of <code><a href="http://developer.android.com//reference/android/net/Uri.html">Uri</a></code> objects. To transfer a file, you must also have permanent read access for the file. For example, the following snippet shows you how to get a file URI from a file name and then add the URI to the array:
#pre2-3-1-4-1
title2-3-2 = Receiving Files from Another Device
p2-3-2-1 = Android Beam file transfer copies files to a special directory on the receiving device. It also scans the copied files using the Android Media Scanner and adds entries for media files to the <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code> provider. This lesson shows you how to respond when the file copy is complete, and how to locate the copied files on the receiving device.
sub_title2-3-2-1 = Respond to a Request to Display Data
p2-3-2-1-1 = When Android Beam file transfer finishes copying files to the receiving device, it posts a notification containing an <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> with the action <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_VIEW">ACTION_VIEW</a></code>, the MIME type of the first file that was transferred, and a URI that points to the first file. When the user clicks the notification, this intent is sent out to the system. To have your app respond to this intent, add an <code><a href="http://developer.android.com//guide/topics/manifest/intent-filter-element.html">&lt;intent-filter&gt;</a></code> element for the <code><a href="http://developer.android.com//guide/topics/manifest/activity-element.html">&lt;activity&gt;</a></code> element of the <code><a href="http://developer.android.com//reference/android/app/Activity.html">Activity</a></code> that should respond. In the <code><a href="http://developer.android.com//guide/topics/manifest/intent-filter-element.html">&lt;intent-filter&gt;</a></code> element, add the following child elements:
dt2-3-2-1-1 = <code><a href="http://developer.android.com//guide/topics/manifest/action-element.html">&lt;action android:name="android.intent.action.VIEW" /&gt;</a></code>
dd2-3-2-1-1 = Matches the  <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_VIEW">ACTION_VIEW</a></code> intent sent from the notification.
dt2-3-2-1-2 = <code><a href="http://developer.android.com//guide/topics/manifest/category-element.html">&lt;category android:name="android.intent.category.CATEGORY_DEFAULT" /&gt;</a></code>
dd2-3-2-1-2 = Matches an  <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> that doesn't have an explicit category.
dt2-3-2-1-3 = <code><a href="http://developer.android.com//guide/topics/manifest/data-element.html">&lt;data android:mimeType="<i>mime-type</i>" /&gt;</a></code>
dd2-3-2-1-3 = Matches a MIME type. Specify only those MIME types that your app can handle.
p2-3-2-1-2 = For example, the following snippet shows you how to add an intent filter that triggers the activity <code>com.example.android.nfctransfer.ViewActivity</code>:
#pre2-3-2-1-1
nc2-3-2-1-1 = <strong>Note:</strong> Android Beam file transfer is not the only source of an <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_VIEW">ACTION_VIEW</a></code> intent. Other apps on the receiving device can also send an <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> with this action. Handling this situation is discussed in the section <a href="http://developer.android.com/#GetDirectory">Get the directory from a content URI</a>.
sub_title2-3-2-2 = Request File Permissions
p2-3-2-2-1 = To read files that Android Beam file transfer copies to the device, request the permission <code><a href="http://developer.android.com//reference/android/Manifest.permission.html#READ_EXTERNAL_STORAGE">READ_EXTERNAL_STORAGE</a></code>. For example:
#pre2-3-2-2-1
p2-3-2-2-2 = If you want to copy transferred files to your app's own storage area, request the permission <code><a href="http://developer.android.com//reference/android/Manifest.permission.html#WRITE_EXTERNAL_STORAGE">WRITE_EXTERNAL_STORAGE</a></code> instead. <code><a href="http://developer.android.com//reference/android/Manifest.permission.html#WRITE_EXTERNAL_STORAGE">WRITE_EXTERNAL_STORAGE</a></code> includes <code><a href="http://developer.android.com//reference/android/Manifest.permission.html#READ_EXTERNAL_STORAGE">READ_EXTERNAL_STORAGE</a></code>.
nc2-3-2-2-1 = <strong>Note:</strong> As of Android 4.2.2 (API level 17), the permission <code><a href="http://developer.android.com//reference/android/Manifest.permission.html#READ_EXTERNAL_STORAGE">READ_EXTERNAL_STORAGE</a></code> is only enforced if the user chooses to do so. Future versions of the platform may require this permission in all cases. To ensure forward compatibility, request the permission now, before it becomes required.
p2-3-2-2-3 = Since your app has control over its internal storage area, you don't need to request write permission to copy a transferred file to your internal storage area.
sub_title2-3-2-3 = Get the Directory for Copied Files
p2-3-2-3-1 = Android Beam file transfer copies all the files in a single transfer to one directory on the receiving device. The URI in the content <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> sent by the Android Beam file transfer notification points to the first transferred file. However, your app may also receive an <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_VIEW">ACTION_VIEW</a></code> intent from a source other than Android Beam file transfer. To determine how you should handle the incoming <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code>, you need to examine its scheme and authority.
p2-3-2-3-2 = To get the scheme for the URI, call <code><a href="http://developer.android.com//reference/android/net/Uri.html#getScheme()">Uri.getScheme()</a></code>. The following code snippet shows you how to determine the scheme and handle the URI accordingly:
#pre2-3-2-3-1
lead2-3-2-3-1 = Get the directory from a file URI
p2-3-2-3-3 = If the incoming <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> contains a file URI, the URI contains the absolute file name of a file, including the full directory path and file name. For Android Beam file transfer, the directory path points to the location of the other transferred files, if any. To get the directory path, get the path part of the URI, which contains all of the URI except the <code>file:</code> prefix. Create a <code><a href="http://developer.android.com//reference/java/io/File.html">File</a></code> from the path part, then get the parent path of the <code><a href="http://developer.android.com//reference/java/io/File.html">File</a></code>:
#pre2-3-2-3-2
lead2-3-2-3-2 = Get the directory from a content URI
p2-3-2-3-4 = If the incoming <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code> contains a content URI, the URI may point to a directory and file name stored in the <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code> content provider. You can detect a content URI for <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code> by testing the URI's authority value. A content URI for <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code> may come from Android Beam file transfer or from another app, but in both cases you can retrieve a directory and file name for the content URI.
p2-3-2-3-5 = You can also receive an incoming <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_VIEW">ACTION_VIEW</a></code> intent containing a content URI for a content provider other than <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code>. In this case, the content URI doesn't contain the <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code> authority value, and the content URI usually doesn't point to a directory.
nc2-3-2-3-1 = <strong>Note:</strong> For Android Beam file transfer, you receive a content URI in the <code><a href="http://developer.android.com//reference/android/content/Intent.html#ACTION_VIEW">ACTION_VIEW</a></code> intent if the first incoming file has a MIME type of "audio/*", "image/*", or "video/*", indicating that the file is media- related. Android Beam file transfer indexes the media files it transfers by running Media Scanner on the directory where it stores transferred files. Media Scanner writes its results to the <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code> content provider, then it passes a content URI for the first file back to Android Beam file transfer. This content URI is the one you receive in the notification <code><a href="http://developer.android.com//reference/android/content/Intent.html">Intent</a></code>. To get the directory of the first file, you retrieve it from <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code> using the content URI.
lead2-3-2-3-3 = Determine the content provider
p2-3-2-3-6 = To determine if you can retrieve a file directory from the content URI, determine the the content provider associated with the URI by calling <code><a href="http://developer.android.com//reference/android/net/Uri.html#getAuthority()">Uri.getAuthority()</a></code> to get the URI's authority. The result has two possible values:
dt2-3-2-3-1 = <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html#AUTHORITY">MediaStore.AUTHORITY</a></code>
dd2-3-2-3-1 = The URI is for a file or files tracked by  <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code>. Retrieve the full file name from  <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code>, and get directory from the file name.
dt2-3-2-3-2 = Any other authority value
dd2-3-2-3-2 = A content URI from another content provider. Display the data associated with the content URI, but don't get the file directory.
p2-3-2-3-7 = To get the directory for a <code><a href="http://developer.android.com//reference/android/provider/MediaStore.html">MediaStore</a></code> content URI, run a query that specifies the incoming content URI for the <code><a href="http://developer.android.com//reference/android/net/Uri.html">Uri</a></code> argument and the column <code><a href="http://developer.android.com//reference/android/provider/MediaStore.MediaColumns.html#DATA">MediaColumns.DATA</a></code> for the projection. The returned <code><a href="http://developer.android.com//reference/android/database/Cursor.html">Cursor</a></code> contains the full path and name for the file represented by the URI. This path also contains all the other files that Android Beam file transfer just copied to the device.
p2-3-2-3-8 = The following snippet shows you how to test the authority of the content URI and retrieve the the path and file name for the transferred file:
#pre2-3-2-3-3
p2-3-2-3-9 = To learn more about retrieving data from a content provider, see the section <a href="http://developer.android.com//guide/topics/providers/content-provider-basics.html#SimpleQuery">Retrieving Data from the Provider</a>.
